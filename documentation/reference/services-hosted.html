---
title: services.xml - Vespa cloud amendments
---

<p>
<a href="http://docs.vespa.ai/documentation/reference/services.html">services.xml</a> is the primary Vespa configuration file.
This documents services.xml features for Vespa cloud applications.
</p>


<h2 id="nodes">nodes</h2>
<p>
In a standalone deployment, nodes for a cluster are specified by listing each node under the
<em>&lt;nodes&gt;</em> element. In cloud applications nodes are specified by count and node resources instead.
</p>
<p><strong>Subelements:</strong> <a href="#node-resources">resources</a> (&lt;node&gt; is not allowed).</p>
<strong>Attributes:</strong>
<ul>
  <li><strong>count</strong>: Non-negative integer. The number of nodes of the cluster.
</ul>
<p>
In addition there are some attributes for specific cluster types, listed below.
</p>


<h3 id="nodes-for-container">&lt;nodes&gt; for &lt;container&gt;</h3>
<ul>
  <li><strong>of</strong> (optional): A content cluster id.
    This attribute can be used to specify that this container service should run on the nodes of a content service.
    If <em>of</em> is specified, only <em>jvmargs</em> can be set in addition.
    No other attributes can be set, as the ones of the referenced content cluster will be used instead.
  </li>
</ul>


<h3 id="nodes-for-content">&lt;nodes&gt; for &lt;content&gt;</h3>
<ul>
  <li><strong>groups</strong> (optional): Non-negative integer.
    Sets the number of <em>groups</em> into which content nodes should be divided. 
    Each group will have an equal share of the nodes and <em>redundancy</em> copies of the corpus,
    and each query will be routed to just one group. This allows scaling to a higher query load than is efficient
    within a single group. Note that taking redundancy to mean the number of copies per group is different
    than when listing groups and nodes explicitly outside hosted Vespa, where redundancy means the number
    of copies across all groups.
    If this is set, no groups can be specified as subelements of this.
    WARNING: Changing from a non-grouped configuration to multiple groups will lead to temporary reduced coverage
    in query serving as data is migrated.
  </li>
</ul>


<h3 id="nodes-for-controllers-slobroks-and-logservers">&lt;nodes&gt; for &lt;controllers&gt; &lt;slobroks&gt; and &lt;logservers&gt;</h3>

<p>
The nodes element nested in these elements allow specifying whether the nodes used should be dedicated to the service
or if it should run on existing nodes. Attribute:
<ul>
  <li><strong>dedicated</strong> (optional): true or false (default false).
    Whether or not separate nodes should be allocated for this service.
  </li>
</ul>
</p>


<h2 id="node-resources">resources</h2>
<p>
Contained in the nodes tag and specifies the resources of each node to allocate.
</p><p>
<strong>Subelements:</strong> None
</p><p>
<strong>Attributes:</strong>
<table class="table">
  <tr><td><strong>vcpu</strong></td><td>float</td>
    <td>CPU, hardware threads</td></tr>
  <tr><td><strong>memory</strong></td><td>float, followed by a byte unit, such as "Gb"</td>
    <td>Memory</td></tr>
  <tr><td><strong>disk</strong></td><td>float followed by a byte unit, such as "Gb"</td>
    <td>Disk space</td></tr>
  <tr><td><strong>disk-speed</strong> (optional)<td>string (enum)</td>
    <td>One of the three values. Container nodes normally uses the disk only for logging,
      and can do with <code><strong>any</strong></code>.
      <table class="table">
      <tr><td><code><strong>fast</strong></code> (default)</td><td>SSD-like disk speed is required</td></tr>
      <tr><td><code><strong>slow</strong></code></td><td>This is sized for spinning disk speed</td></tr>
      <tr><td><code><strong>any</strong></code></td> <td>Performance does not depend on disk speed</td></tr>
      </table>
    </td></tr>
</table>
Example:
<pre>
&lt;nodes count="4"&gt;
  &lt;resources vcpu="2.5" memory="32Gb" disk="100Gb" disk-speed="any"/&gt;
&lt;/nodes&gt;
</pre>
</p>


<h2 id="admin-version-4-0">&lt;admin version="4.0"&gt;</h2>
<p>
Admin version 4 is used for explicit control over the number of admin services running and whether these should run on 
dedicated nodes or on some existing container cluster in the application.
In most cases, there is no need to specify this explicitly.
</p>

<h3>Sub-elements</h3>
<table class="table table-striped">
  <thead>
  <tr><th>Element<th>Quantity<th>Description</tr>
  </thead><tbody>
  <tr><td><code>&lt;slobroks&gt;&lt;nodes .../&gt;</code></a>
      <td>0 or 1</td>
      <td>Controls the nodes used for instance internal service location brokering</td></tr>
  <tr><td><code>&lt;logservers&gt;&lt;nodes dedicated='true' .../&gt;</code></a>
      <td>0 or 1</td>
      <td>Controls the node used as log server. At most 1 node can be configured.
  </tbody>
</table>



<h2 id="environment-and-region-variants">Environment and region variants</h2>

<p>Application packages support defining different configuration settings
for different <em>instances</em>, <em>environments</em> and <em>regions</em>.
To use this you must import the <em>deploy</em> namespace:
</p>
<pre>
&lt;services version="1.0" <strong style="background-color: yellow;">xmlns:deploy="vespa"</strong>&gt;
</pre>
<p>Deploy directives are used to specify in which environment and/or region an XML element should be included.
Define a different configuration for different <em>environments</em> and <em>regions</em>:
</p>
<pre>
&lt;content version="1.0"&gt;
  &lt;redundancy&gt;1&lt;/redundancy&gt;
  &lt;documents&gt;
    &lt;document type="music.sd" mode="index" /&gt;
  &lt;/documents&gt;
  &lt;nodes <strong style="background-color: yellow;">deploy:environment="dev"</strong> count="1" /&gt;
  &lt;nodes <strong style="background-color: yellow;">deploy:environment="prod"</strong> <strong style="background-color: yellow;">deploy:region="us-west-1"</strong> count="60" /&gt;
  &lt;nodes <strong style="background-color: yellow;">deploy:environment="prod"</strong> <strong style="background-color: yellow;">deploy:region="us-east-3"</strong> count="80" /&gt;
&lt;/content&gt;
</pre>
<p>
This example configures the number of content nodes in the different environment and regions.
Deploying the application in the <em>dev</em> environment gives:
<pre>
&lt;content version="1.0"&gt;
  &lt;redundancy&gt;1&lt;/redundancy&gt;
  &lt;documents&gt;
    &lt;document type="music.sd" mode="index" /&gt;
  &lt;/documents&gt;
  &lt;nodes count="1" /&gt;
&lt;/content&gt;
</pre>
Whereas in <em>prod.us-west-1</em> it is:
<pre>
&lt;content version="1.0"&gt;
  &lt;redundancy&gt;1&lt;/redundancy&gt;
  &lt;documents&gt;
    &lt;document type="music.sd" mode="index" /&gt;
  &lt;/documents&gt;
  &lt;nodes count="60" /&gt;
&lt;/content&gt;
</pre>
This feature can be used to modify any config per zone.
</p><p>
The deploy directives have a set of override rules:
</p>
<ul>
  <li>A directive specifying more conditions will override one specifying fewer.</li>
  <li>Directives are inherited in child elements.</li>
  <li>When multiple XML elements with the same name is specified
    (e.g. when specifying search or docproc chains), the <em>id</em> attribute of the element
    is used together with the element name when applying directives.</li>
</ul>


<h3 id="advanced">Advanced</h3>
<p>
More than one instance, region or environment can be specified in the attribute, separated by space. Notes:
<ul>
  <li>The region attribute is only respected if given environment exists in
  multiple regions. This is currently true for <em>prod</em> and <em>dev</em></li>
  <li>A tag which only specifies region, will match both prod and dev environment in that region</li>
</ul>
The namespace can be applied to any element. Example:
<pre>
&lt;container id="default" version="1.0" <span style="background: yellow">deploy:environment="perf test staging prod"</span>&gt;
  &lt;search&gt;
    &lt;chain id="default" inherits="vespa"&gt;
      &lt;searcher bundle="basic-application" id="com.yahoo.example.ExampleSearcher"&gt;
        &lt;config name="example.message"&gt;
          &lt;message&gt;Hello from application config&lt;/message&gt;
          &lt;message <span style="background: yellow">deploy:region="us-east-3"</span>&gt;Hello from east colo!&lt;/message&gt;
        &lt;/config&gt;
      &lt;/searcher&gt;
    &lt;/chain&gt;
  &lt;/search&gt;
</pre>
Above, the <em>container</em> element is configured for the 4 environments only (it will not apply to <em>dev</em>) -
and in region <em>us-east-3</em>, the config is different.


<h2 id="controllers">controllers</h2>
<p>Under <code>content</code> provides control over the nodes used as cluster controllers in this cluster on hosted Vespa.
If this element is not specified, 3 nodes from the content cluster are assigned as cluster controllers
(from different groups if applicable). If this is specified, there is one mandatory sub-element,
<a href="#nodes">nodes</a>.
</p>
